import{r as f,d as P,g as T,M as U}from"./index-ebc513dd.js";import{b as q,d as E,r as _,A as j,l as m,V as p,W as a,a0 as G,a3 as H,M as o,u as c,m as $,_ as z,a4 as d}from"./vue-51c2f431.js";import J from"./icon-f8fbe000.js";import{I as Q}from"./manifest-43e17205.js";import{R as X}from"./index-b07945fd.js";import{F as Y,a as Z}from"./index-3f5d4a71.js";import{T as ee,A as te}from"./index-7bf61179.js";import{I as le}from"./index-15716071.js";import{B as oe}from"./index-3b3d7414.js";import{I as ae}from"./index-8fdc26dc.js";import{D as ne}from"./index-c22455b5.js";function we(i){return f.post({url:"/adminapi/merchant/menu/list",params:i})}function ie(i){return f.post({url:"/adminapi/merchant/menu/treeSimple",params:i})}function re(i){return f.post({url:"/adminapi/merchant/menu/detail",params:i})}function se(i){return f.post({url:"/adminapi/merchant/menu/add",params:i})}function me(i){return f.post({url:"/adminapi/merchant/menu/edit",params:i})}function Ne(i){return f.post({url:"/adminapi/merchant/menu/del",params:i})}const Ce=[{colKey:"title",title:"标题",minWidth:"120px"},{colKey:"icon",title:"图标"},{colKey:"path",title:"路由地址"},{colKey:"perms",title:"权限字符"},{colKey:"orderNo",title:"排序"},{colKey:"hidden",title:"隐藏"},{colKey:"type",title:"类型"},{colKey:"operate",title:"操作",fixed:"right",minWidth:"140px"}],pe=[{label:"显示",value:0},{label:"隐藏",value:1}],ue=[{label:"目录",value:"L"},{label:"菜单",value:"M"},{label:"按钮",value:"B"}],de=[{label:"缓存",value:1},{label:"不缓存",value:0}],ce=q(()=>P().filter(u=>u.startsWith("merchant/")).filter(u=>!u.includes("/components/")).map(u=>({label:u,value:u}))),fe={class:"dialog-title"},ye=["src"],_e="https://tdesign.gtimg.com/icon/0.4.0/fonts/index.css",Ke=E({__name:"edit",emits:["success"],setup(i,{expose:g,emit:u}){const S=u,v=_(),I=()=>{v.value.init(e.icon)},w=n=>{e.icon=n},h={id:0,pid:0,app:"merchant",title:"",path:"",icon:"",component:"",type:"M",orderNo:0,hidden:0,redirect:"",perms:"",keep_alive:0},e=j({...h}),k=_([]),N=async()=>{const{data:n}=await ie({app:"merchant"});k.value=n.list},x=_(null),b=_(!1),V=_("添加菜单"),C=(n,t)=>{if(n)V.value="编辑菜单",K(n);else{V.value="添加菜单";for(const r in h)e[r]=h[r];t&&(e.pid=t)}b.value=!0,N()},K=async n=>{const{data:t}=await re({id:n});for(const r in e)t[r]!=null&&t[r]!==void 0&&(e[r]=t[r])};g({init:C});const R=n=>{e.component=n===0?"Layout":""},B={name:[{required:!0,message:"必填",type:"error"}],title:[{required:!0,message:"必填",type:"error"}]},M=async()=>{const n=await x.value.validate();if(typeof n!="object"&&n){let t;e.id===0?t=await se(e):t=await me(e),t.code===1?(U.success(t.msg),b.value=!1,S("success")):U.error(t.msg)}};return(n,t)=>{const r=X,s=Y,D=ee,y=le,L=oe,A=te,O=ae,W=Z,F=ne;return m(),p(F,{visible:b.value,"onUpdate:visible":t[11]||(t[11]=l=>b.value=l),"close-on-overlay-click":!1,"destroy-on-close":!0,"on-confirm":M,"confirm-on-enter":"",width:"500"},{header:a(()=>[G("div",fe,H(V.value),1)]),default:a(()=>[o(W,{ref_key:"formRef",ref:x,"label-align":"left",data:e,rules:B,"label-width":80,onSubmit:M},{default:a(()=>[o(s,{label:"菜单类型",name:"type"},{default:a(()=>[o(r,{modelValue:e.type,"onUpdate:modelValue":t[0]||(t[0]=l=>e.type=l),options:c(ue)},null,8,["modelValue","options"])]),_:1}),o(s,{label:"父级菜单",name:"pid"},{default:a(()=>[o(D,{modelValue:e.pid,"onUpdate:modelValue":t[1]||(t[1]=l=>e.pid=l),placeholder:"请选择父级菜单",data:k.value,clearable:"",filterable:"",onChange:R},null,8,["modelValue","data"])]),_:1}),o(s,{label:"菜单名称",name:"title"},{default:a(()=>[o(y,{modelValue:e.title,"onUpdate:modelValue":t[2]||(t[2]=l=>e.title=l),clearable:"",placeholder:"请输入菜单名称"},null,8,["modelValue"])]),_:1}),o(J,{ref_key:"iconSearchRef",ref:v,onSuccess:w},null,512),e.type==="L"||e.type==="M"?(m(),p(s,{key:0,label:"菜单图标",name:"icon"},{default:a(()=>[o(y,{modelValue:e.icon,"onUpdate:modelValue":t[3]||(t[3]=l=>e.icon=l),clearable:"",placeholder:"请选择菜单图标"},{"prefix-icon":a(()=>[e.icon.startsWith("http")||e.icon.startsWith("/")?(m(),$("img",{key:0,src:c(T)(e.icon),style:{marginRight:"8px",maxWidth:"24px"}},null,8,ye)):(m(),p(c(Q),{key:1,name:`t-icon t-icon-${e.icon}`,url:_e,style:{"margin-right":"8px"}},null,8,["name"]))]),_:1},8,["modelValue"]),o(L,{theme:"primary",onClick:I},{default:a(()=>[...t[12]||(t[12]=[z("选择图标",-1)])]),_:1})]),_:1})):d("",!0),e.type==="L"||e.type==="M"?(m(),p(s,{key:1,label:"路由路径",name:"path",help:"访问的路由地址，如：`user`"},{default:a(()=>[o(y,{modelValue:e.path,"onUpdate:modelValue":t[4]||(t[4]=l=>e.path=l),clearable:"",placeholder:"请输入路由路径"},null,8,["modelValue"])]),_:1})):d("",!0),e.type==="M"?(m(),p(s,{key:2,label:"组件路径",name:"component",help:"组件路径，如：`user/setting/index`，默认在`pages`目录下",tips:"此处支持下拉和模糊搜索；外链使用Iframe,跳转路径为外链地址"},{default:a(()=>[o(A,{modelValue:e.component,"onUpdate:modelValue":t[5]||(t[5]=l=>e.component=l),options:c(ce),clearable:"","highlight-keyword":"",filterable:"",placeholder:"请输入组件地址组件"},null,8,["modelValue","options"])]),_:1})):d("",!0),e.type==="M"||e.type==="B"?(m(),p(s,{key:3,label:"权限字符",name:"perms",help:"将作为server端API验权使用，跟该方法路径一致",tips:"应用+api+路径,例如：adminapi/setting/socialite/list"},{default:a(()=>[o(y,{modelValue:e.perms,"onUpdate:modelValue":t[6]||(t[6]=l=>e.perms=l),clearable:"",placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1})):d("",!0),o(s,{label:"菜单排序",name:"sort",help:"数值越小越排前"},{default:a(()=>[o(O,{modelValue:e.orderNo,"onUpdate:modelValue":t[7]||(t[7]=l=>e.orderNo=l),clearable:"",placeholder:"请输入排序",style:{width:"500px"},theme:"column",min:0},null,8,["modelValue"])]),_:1}),e.type==="L"||e.type==="M"?(m(),p(s,{key:4,label:"是否缓存",name:"cache",help:"开启缓存后，页面切换时不会重新加载"},{default:a(()=>[o(r,{modelValue:e.keep_alive,"onUpdate:modelValue":t[8]||(t[8]=l=>e.keep_alive=l),options:c(de)},null,8,["modelValue","options"])]),_:1})):d("",!0),e.type==="L"||e.type==="M"?(m(),p(s,{key:5,label:"是否隐藏",name:"hidden",help:"选择隐藏则路由将不会出现在侧边栏，但仍然可以访问"},{default:a(()=>[o(r,{modelValue:e.hidden,"onUpdate:modelValue":t[9]||(t[9]=l=>e.hidden=l),options:c(pe)},null,8,["modelValue","options"])]),_:1})):d("",!0),e.type==="L"||e.type==="M"?(m(),p(s,{key:6,label:"跳转路径",name:"redirect",help:"分割菜单的时候用到"},{default:a(()=>[o(y,{modelValue:e.redirect,"onUpdate:modelValue":t[10]||(t[10]=l=>e.redirect=l),clearable:"",placeholder:"顶级栏目需要输入跳转路径"},null,8,["modelValue"])]),_:1})):d("",!0)]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{Ke as _,Ce as c,Ne as d,we as l};
