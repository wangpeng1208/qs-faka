import{s as A,g as K,r as N}from"./user-6eaedfbc.js";import{p as P}from"./global-0d825ba6.js";import{aY as z,M as I}from"./index-5ae314bf.js";import{I as O}from"./index-4e516f6a.js";import{S as U}from"./index-c8633d5c.js";import{R as B}from"./index-a9524ed3.js";import{D as M}from"./index-d23aa298.js";import{A as L}from"./index-03a98d2d.js";import{T as $}from"./index-552daebe.js";import{D as q}from"./index-bf58812f.js";import{d as G,A as W,r as l,b as Y,l as c,V as j,W as m,M as o,m as g,_ as h,a4 as b}from"./vue-d500b9b9.js";const F={key:0},H={key:1},ie=G({__name:"rate",setup(J,{expose:w}){const R=async()=>{await A({user_id:t.user_id,type:t.rate_type})},T=[{label:"使用角色分组",value:0},{label:"单独定义",value:1}],f=[{label:"用户费率",value:1},{label:"通道费率",value:0}],D=[{colKey:"id",title:"ID"},{colKey:"title",title:"通道名称"},{colKey:"show_name",title:"显示名称"},{colKey:"rate",title:"费率",edit:{component:O,props:{autofocus:!0,placeholder:"请输入费率",tips:"单位：千分率",suffix:"‰",theme:"normal",min:0},validateTrigger:"change",abortEditOnEvent:["onEnter"],onEdited:e=>{t.rate=e.newRowData.rate,t.channel_id=e.newRowData.id,t.status=e.newRowData.status,_()},rules:[{required:!0,message:"不能为空"}],defaultEditable:!1}},{colKey:"status",title:"模式",cell:(e,{row:a})=>{var r;return(r=f.find(d=>d.value===a.status))==null?void 0:r.label},edit:{component:U,props:{options:f},onEdited:e=>{t.rate=e.newRowData.rate,t.channel_id=e.newRowData.id,t.status=e.newRowData.status,_()}}}],t=W({rate_type:1,channel_id:0,rate:0,status:0,user_id:0}),_=async()=>{(await K({...t})).code===1&&(I.success("操作成功"),u())},n=l(!1),v=l(),S=e=>{t.user_id=e.id,v.value=`${e.username} 用户费率设置`,u(),n.value=!0},s=l({defaultPageSize:20,total:0,defaultCurrent:1}),i=l([]),u=async()=>{const{data:e}=await N({id:t.user_id});i.value=e.list,t.rate_type=e.user.rate_type,s.value.total=e.total},x=e=>{s.value.defaultCurrent=e.current,s.value.defaultPageSize=e.pageSize,u()},C=z(),k=Y(()=>({offsetTop:C.isUseTabsRouter?48:0,container:`.${P}-layout`}));return w({init:S}),(e,a)=>{const r=B,d=M,y=L,E=$,V=q;return c(),j(V,{visible:n.value,"onUpdate:visible":a[1]||(a[1]=p=>n.value=p),"close-on-overlay-click":!1,"destroy-on-close":!0,footer:!1,header:v.value,width:"900px"},{default:m(()=>[o(r,{modelValue:t.rate_type,"onUpdate:modelValue":a[0]||(a[0]=p=>t.rate_type=p),name:"rate_type",options:T,onChange:R},null,8,["modelValue"]),o(d),t.rate_type===0?(c(),g("div",F,[o(y,null,{default:m(()=>[...a[2]||(a[2]=[h("自行到“分配角色”里设置",-1)])]),_:1})])):b("",!0),t.rate_type===1?(c(),g("div",H,[o(y,null,{default:m(()=>[...a[3]||(a[3]=[h(" 模式：用户费率 为设置该用户在该通道的费率；通道费率 则遵循对应通道的费率 ",-1)])]),_:1}),o(E,{ref:"tableRef","row-key":"id",data:i.value,columns:D,hover:i.value.length>0,"header-affixed-top":k.value,pagination:s.value,"lazy-load":"","table-layout":"auto","max-height":"100%",onPageChange:x},null,8,["data","hover","header-affixed-top","pagination"])])):b("",!0)]),_:1},8,["visible","header"])}}});export{ie as _};
