import{f as v}from"./date-20546ee0.js";import{r as p}from"./index-c2dd6a24.js";import{T as x,B as K,L as N,m as R,M as z,n as S,o as j,q as A}from"./ui-ba7aaa7e.js";import{e as D,t as M,d as q,r as C,l as V,P as u,a3 as O,a4 as a,f as r,H as n,ab as o,Q as f,F as y,aa as E,I as P}from"./vue-bf422dc1.js";function re(t){return p.post({url:"/adminapi/order/order/list",params:t})}function ne(t){return p.post({url:"/adminapi/order/order/del",params:t})}function se(){return p.post({url:"/adminapi/order/order/clear"})}function H(t){return p.post({url:"/adminapi/order/order/notify",params:t})}function Q(t){return p.post({url:"/adminapi/order/order/refund",params:t})}function U(t){return p.post({url:"/adminapi/order/order/freeze",params:t})}const B=[{label:"未支付",value:0,theme:"warning"},{label:"已支付",value:1,theme:"success"},{label:"已关闭",value:2,theme:"danger"},{label:"已退款",value:3,theme:"warning"}],oe=[{width:"180px",colKey:"trade_no",title:"订单号",fixed:"left"},{colKey:"shop_name",width:"180px",title:"店铺名",cell:(t,{row:l})=>`${l.shop.shop_name}`},{colKey:"username",width:"180px",title:"商户名",cell:(t,{row:l})=>`${l.user.username}`},{colKey:"goods_name",width:"180px",title:"商品名"},{colKey:"contact",width:"180px",title:"联系方式"},{colKey:"quantity",width:"100px",title:"商品数量"},{colKey:"total_price",title:"订单金额"},{colKey:"fee",title:"手续费"},{colKey:"rate",title:"手续费率",cell:(t,{row:l})=>`${(l.rate*1e3).toFixed(2)}‰`},{colKey:"channel",title:"支付渠道",cell:(t,{row:l})=>`${l.channel.title}`},{width:"150px",colKey:"status",title:"订单状态",fixed:"right",cell:(t,{row:l})=>{const i=B.find(g=>g.value===l.status),m=t(x,{theme:i.theme,variant:"light"},()=>i==null?void 0:i.label);let c;return l.status===1?c=t(K,{vPerms:"['admin/order/order/refund']",hover:"color",size:"small",style:"margin-left: 10px",onClick:()=>{J(l)}},()=>"退款"):l.status===0?c=t(K,{vPerms:"['admin/order/order/notify']",hover:"color",size:"small",onClick:()=>{G(l)}},()=>"补单"):c="",[m,c]}},{colKey:"cards_count",title:"取卡状态",fixed:"right",cell:(t,{row:l})=>t(x,{theme:l.cards_count===l.quantity?"success":"warning",variant:"light"},()=>l.cards_count===0?"未取卡":l.cards_count===l.quantity?"已取卡":"部分取卡")},{colKey:"is_freeze",title:"冻结",fixed:"right",cell:(t,{row:l})=>{let i="";return l.status===1&&(i=t(N,{theme:l.is_freeze?"danger":"success",vPerms:"['admin/order/order/freeze']",hover:"color",onClick:()=>{W(l)}},()=>l.is_freeze?"解冻":"冻结")),i}},{colKey:"create_ip",title:"Ip"},{width:"200px",colKey:"create_at",title:"下单时间",cell:(t,{row:l})=>v(l.create_at)},{width:"100px",colKey:"operate",title:"操作",fixed:"right"}],k=(t,l,i)=>{const m=R.confirm({header:"提醒",body:i,confirmBtn:{content:"提交",theme:"primary",loading:!1},closeOnOverlayClick:!1,onConfirm:async()=>{const c=await l({id:t.id});c.code===1?(z.success(c.msg),t=Object.assign(t,c.data),m.hide()):z.error(c.msg)}})},G=t=>{k(t,H,"确认要设置这个订单已支付吗？该操作不可恢复")},J=t=>{k(t,Q,"确认要退款吗？该操作不可恢复")},W=t=>{let l;t.is_freeze===1?l="确认要解冻吗？":l="确认要冻结吗？此处用于存在投诉争议的订单，手工冻结。冻结后，该订单将不会被自动退款，也不会被自动结算。",k(t,U,l)},X={key:0},Y={key:1},Z={name:"RowDetail"},ie=D({...Z,props:{payTypeOptions:{type:Array,default:()=>[]}},setup(t,{expose:l}){const i=t,{payTypeOptions:m}=M(i),c=q(()=>{var _;return(_=m.value.find(b=>b.value===e.paytype))==null?void 0:_.label}),g=q(()=>B.filter(_=>_.value===e.status)),T=C("订单详情"),h=C(!1),e=V({}),$=_=>{h.value=!0,Object.assign(e,_)},w=()=>{h.value=!1};return l({init:$}),(_,b)=>{const s=S,F=x,I=j,L=A;return u(),O(L,{visible:h.value,"onUpdate:visible":b[0]||(b[0]=d=>h.value=d),"close-on-overlay-click":!1,size:"100%","destroy-on-close":!0,header:T.value,"on-confirm":w},{default:a(()=>[r(I,{title:`${e.trade_no}的订单详情`},{default:a(()=>[r(s,{label:"商户账号"},{default:a(()=>{var d;return[n(o((d=e==null?void 0:e.user)==null?void 0:d.username),1)]}),_:1}),r(s,{label:"流水号"},{default:a(()=>[n(o(e==null?void 0:e.transaction_id),1)]),_:1}),r(s,{label:"商品名称"},{default:a(()=>[n(o(e.goods_name),1)]),_:1}),r(s,{label:"商品数量"},{default:a(()=>[n(o(e.quantity),1)]),_:1}),r(s,{label:"商品单价"},{default:a(()=>[n(o(e.goods_price),1)]),_:1}),r(s,{label:"商品成本价"},{default:a(()=>[n(o(e.goods_cost_price),1)]),_:1}),r(s,{label:"优惠券"},{default:a(()=>[e.coupon_type?(u(),f("span",X,"优惠"+o(e.coupon_price)+"元",1)):(u(),f("span",Y,"未使用"))]),_:1}),r(s,{label:"总价"},{default:a(()=>[n(o(e.total_price),1)]),_:1}),r(s,{label:"总成本价"},{default:a(()=>[n(o(e.total_cost_price),1)]),_:1}),r(s,{label:"取卡密码"},{default:a(()=>[n(o(e.take_card_type===2?e.take_card_password:"未设置"),1)]),_:1}),r(s,{label:"联系方式"},{default:a(()=>[n(o(e.contact),1)]),_:1}),r(s,{label:"邮件通知"},{default:a(()=>[n(o(e.email_notify===1?e.email:"未设置"),1)]),_:1}),r(s,{label:"短信通知"},{default:a(()=>[n(o(e.sms_notify===1?e.contact:"未设置"),1)]),_:1}),r(s,{label:"支付类型"},{default:a(()=>[n(o(c.value),1)]),_:1}),r(s,{label:"交易通道"},{default:a(()=>{var d;return[n(o((d=e==null?void 0:e.channel)==null?void 0:d.title),1)]}),_:1}),r(s,{label:"手续费率"},{default:a(()=>[n(o(e.rate*1e3)+"‰",1)]),_:1}),r(s,{label:"手续费"},{default:a(()=>[n(o(e.fee),1)]),_:1}),r(s,{label:"状态"},{default:a(()=>[(u(!0),f(y,null,E(g.value,d=>(u(),O(F,{key:d.value,theme:d.theme},{default:a(()=>[n(o(d.label),1)]),_:2},1032,["theme"]))),128))]),_:1}),r(s,{label:"取卡状态"},{default:a(()=>[e.cards_count>0?(u(),f(y,{key:0},[e.cards_count>=e.quantity?(u(),f(y,{key:0},[n(" 已取 ")],64)):(u(),f(y,{key:1},[n(" 已取部分 ")],64))],64)):(u(),f(y,{key:1},[n(" 未取 ")],64))]),_:1}),r(s,{label:"提交时间"},{default:a(()=>[n(o(P(v)(e.create_at)),1)]),_:1}),r(s,{label:"提交IP"},{default:a(()=>[n(o(e.create_ip),1)]),_:1}),r(s,{label:"完成时间"},{default:a(()=>[n(o(e.success_at>0?P(v)(e.success_at):""),1)]),_:1})]),_:1},8,["title"])]),_:1},8,["visible","header"])}}});export{ie as _,se as a,oe as c,ne as d,re as l};
