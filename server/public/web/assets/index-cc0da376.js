import{e as O,a8 as W,l as j,r as u,o as E,d as F,P as h,a3 as g,a4 as a,a7 as v,f as o,I as m,H as s,ab as T,a9 as S,n as J}from"./vue-bf422dc1.js";import{l as K}from"./category-2df42ada.js";import{l as Q,b as X,s as Y}from"./good-59137408.js";import{R as Z}from"./index-9229ca78.js";import{p as ee}from"./global-0d825ba6.js";import{u as te}from"./index-b0aabda4.js";import{f as ae}from"./date-20546ee0.js";import oe from"./GoodsLink-8a9e5847.js";import{c as ne}from"./constant-755fa812.js";import{T as se}from"./icons-a8498fb6.js";import{m as le,M as p,B as ie,d as re,I as ce,S as de,T as ue,W as me,L as pe,a as fe,N as _e,b as he}from"./ui-ba7aaa7e.js";import"./no-list-e2f85d5e.js";import"./libs-51817cd7.js";import"./plugins-ca970193.js";import"./others-9f318174.js";import"./echarts-bf9d612c.js";import"./link-34df8940.js";import"./link-ed3394d6.js";const ge={class:"category-header c-flex"},ve={class:"l"},ye={class:"r c-flex"},ke={name:"Goods"},qe=O({...ke,setup(Ce){const f=W(),c=j({cate_id:null,name:""}),{query:x}=f.currentRoute.value;x.cate_id&&(c.cate_id=+x.cate_id);const R=te(),b=u([]),i=u({defaultPageSize:20,total:0,defaultCurrent:1}),P=u(!1),V=u(!1),_=async()=>{V.value=!0;const n={page:i.value.defaultCurrent,limit:i.value.defaultPageSize,...c};try{const{data:e}=await Q(n);b.value=e.list,i.value={...i.value,total:e.total}}catch{}finally{V.value=!1}},$=u([]),B=async()=>{const{data:n}=await K();$.value=n.list};E(()=>{_(),B()});const N=(n,e)=>{i.value.defaultCurrent=n.current,i.value.defaultPageSize=n.pageSize,_()},z=u(),U=async n=>{var e;await J(),(e=z.value)==null||e.init(n.id)},I=async n=>{const e=le({header:"提醒",body:`是否确认删除(${n.name})？`,confirmBtn:"确认",onConfirm:({e:l})=>{e.hide();const{id:y}=n;X({id:y}).then(r=>{r.code===1?(_(),p.success("删除成功")):p.error(`删除失败：${r.msg}`)}).catch(r=>{p.error("删除失败")})},onClose:({e:l,trigger:y})=>{e.hide()}})},D=async(n,e)=>{try{const l=await Y({id:n,val:e});l.code===1?p.success(l.msg):p.error(l.msg)}catch{p.error("修改失败")}},G=n=>{const{id:e}=n;f.push(`/merchant/goods/edit?id=${e}`)},M=F(()=>({offsetTop:R.isUseTabsRouter?48:0,container:`.${ee}-layout`}));return(n,e)=>{const l=ie,y=re,L=ce,r=de,k=ue,w=me,C=pe,q=fe,A=_e,H=he;return h(),g(H,{title:"商品列表",class:"basic-container",bordered:!1},{default:a(()=>[v("div",ge,[v("div",ve,[o(l,{theme:"primary",onClick:e[0]||(e[0]=t=>m(f).push("/merchant/goods/add"))},{default:a(()=>[s(" 添加 ")]),_:1}),o(l,{theme:"danger",onClick:e[1]||(e[1]=t=>m(f).push("/merchant/goods/trash"))},{default:a(()=>[s(" 回收站 ")]),_:1})]),v("div",ye,[o(r,null,{default:a(()=>[o(y,{modelValue:c.cate_id,"onUpdate:modelValue":e[2]||(e[2]=t=>c.cate_id=t),clear:_,empty:"没有分类",placeholder:"全部分类",type:"search",clearable:"",options:$.value},null,8,["modelValue","options"]),o(L,{modelValue:c.name,"onUpdate:modelValue":e[3]||(e[3]=t=>c.name=t),placeholder:"请输入商品名",clearable:""},{"suffix-icon":a(()=>[o(m(se))]),_:1},8,["modelValue"]),o(l,{theme:"default",variant:"outline",onClick:_},{default:a(()=>[s("查询")]),_:1})]),_:1})])]),o(q,{data:b.value,columns:m(ne),"row-key":"id","vertical-align":"middle",hover:b.value.length>0,pagination:i.value,loading:V.value,"header-affixed-top":M.value,"table-layout":"auto","max-height":"100%",onPageChange:N},{name:a(({row:t})=>[o(r,{direction:"vertical",size:"small",class:"tag-demo light"},{default:a(()=>[v("span",null,[s(T(t.name)+" ",1),t.wholesale_discount==1?(h(),g(k,{key:0,title:"支持批发优惠",theme:"success",variant:"light",size:"small",shape:"round"},{default:a(()=>[s("惠")]),_:1})):S("",!0),t.coupon_type==1?(h(),g(k,{key:1,title:"支持优惠券",theme:"primary",variant:"light",size:"small",shape:"round"},{default:a(()=>[s("券")]),_:1})):S("",!0),t.take_card_type!=0?(h(),g(k,{key:2,title:"提卡必填或选填取卡密码",theme:"warning",variant:"light",size:"small",shape:"round"},{default:a(()=>[s("取")]),_:1})):S("",!0),t.visit_type==1?(h(),g(k,{key:3,title:"商品购买页面需要访问密码",theme:"danger",variant:"light",size:"small",shape:"round"},{default:a(()=>[s("密")]),_:1})):S("",!0)])]),_:2},1024)]),status:a(({row:t})=>[o(w,{modelValue:t.status,"onUpdate:modelValue":d=>t.status=d,"custom-value":[1,0],onClick:d=>D(t.id,t.status)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),create_at:a(({row:t})=>[v("span",null,T(m(ae)(t.create_at)),1)]),operation:a(({row:t})=>[o(r,null,{default:a(()=>[o(C,{theme:"primary",hover:"color",onClick:d=>U(t)},{default:a(()=>[s("链接")]),_:2},1032,["onClick"]),o(C,{theme:"primary",hover:"color",onClick:d=>m(f).push(`/merchant/goods/card/add?goods_id=${t.id}`)},{default:a(()=>[s("加库存")]),_:2},1032,["onClick"]),o(C,{theme:"primary",hover:"color",onClick:d=>G(t)},{default:a(()=>[s("编辑")]),_:2},1032,["onClick"]),o(C,{theme:"danger",hover:"color",onClick:d=>I(t)},{default:a(()=>[s("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),empty:a(()=>[o(Z,{title:"",tip:"暂无相关数据",type:"list"})]),_:1},8,["data","columns","hover","pagination","loading","header-affixed-top"]),o(A,{loading:P.value,size:"small",fullscreen:""},null,8,["loading"]),o(oe,{ref_key:"goodLinkRef",ref:z},null,512)]),_:1})}}});export{qe as default};
